_ignore-dirs:
- output-virtualbox-iso
- packer_cache

containers:
  unison:
    setup:
    - !Alpine v3.4
    - !Repo edge/testing
    - !Install [alpine-sdk, inotify-tools-dev, ocaml]

commands:
  build: !Command
    environ:
      # Note this version must match the one in brew
      UNISON_VERSION: 2.48.4
    run: |
      set -ex
      [ -d /work/http ] || mkdir /work/http
      cd /tmp
      curl -O http://www.seas.upenn.edu/~bcpierce/unison/download/releases/unison-$UNISON_VERSION/unison-$UNISON_VERSION.tar.gz
      tar -xzf unison-$UNISON_VERSION.tar.gz
      cd src
      make GLIBC_SUPPORT_INOTIFY=true UISTYLE=text INSTALLDIR=/work NATIVE=true STATIC=true install
